
 pipeline {
    agent any 
    tools {
        maven 'maven3.8.5'
    }
    stages {
        stage('Stage 1') {
            steps {
                echo 'Hello world!' 
            }
        }
        stage('Checkout') { 
            steps {
              git branch: 'master', credentialsId: 'c75f4dce-eaa5-4c6a-831f-9c5f15732c58', url: 'git@gitlab.direa.synology.me:cruzapim-k8s/authserver.git'
            }
        }
        stage ('Build'){
          steps {
             sh 'mvn clean package -Dcheckstyle.skip -Dspotbugs.skip -Dpmd.skip -DskipTests'
          }
          //sh "mvn -v"
          //sh "mvn clean"
          //sh "mvn build"
        }
        /* stage("Build") {
            steps {
                withMaven(mavenSettingsConfig: 'Maven_config') {
                    sh "echo Build"
                    sh "mvn clean package -Dmaven.test.skip=true"
                }
            }
        } */

        /*stage("Delivery To Nexus") {
            steps {
                //withMaven(mavenSettingsConfig: 'Maven_config') {
                    sh "mvn deploy -Dmaven.test.skip=true"
                    sh "echo Delivery"
                //}
            }
        }*/
        stage('Deploy') {
          steps {
              sshagent(credentials : ['1db082f4-6b48-4298-9bbe-e937287a74a7']) {
                    sh 'ls /home/direa'
                    // sh 'ssh -tt apim@220.75.198.106 -p96'
                    sh 'ssh apim@192.168.1.96 ls /home'
                    echo pwd()
                    echo 'Test SSH done'
                    //sh 'ssh id@host mkdir -p /home/cnabro/deploy/dobby-work'
                    //sh 'scp -r ./public id@host:/home/cnabro/deploy/dobby-work'
                }
           }
       }

    }
}
